# 심층 리뷰 스킬 — 독자 시뮬레이션 (Reader Simulation)

파일 전체를 개념 단위로 자동 분할하고, 각 단위를 병렬 서브에이전트로 리뷰/수정합니다.

앞 5개 스킬이 각각의 축(골격/이해/목소리/흐름/사실)을 다룬 후, 이 스킬은 **처음 읽는 독자의 관점**에서 통합 점검합니다. 개별 항목의 품질이 아니라, **흐름 속에서의 독자 경험**만 다룹니다.

## 파이프라인 위치

```
/edit-writing → /clarify-writing → /refine-style → /smooth-flow → /verify-facts → ▶ /deep-review → /align-reference
  골격             이해               목소리          흐름            사실              독자 시뮬레이션    레퍼런스 정렬
```

이 스킬은 파이프라인의 **여섯 번째 단계**입니다:
- 글의 뼈대 → `/edit-writing`
- 독자의 이해 → `/clarify-writing`
- 톤, 리듬, 서사 → `/refine-style`
- 읽기 흐름 → `/smooth-flow`
- 사실관계 → `/verify-facts`
- 레퍼런스 정렬 → `/align-reference`

## 인자
- `$ARGUMENTS`: 수정할 파일 경로 (선택사항). 없으면 사용자에게 파일 경로를 요청합니다.

---

## 3개 독자 경험 축

---

### 축 1. 읽기 관성 (Reading Momentum)

**"이 지점에서 독자가 읽기를 멈추는가?"**

독자가 글을 읽다가 멈추게 되는 지점을 찾아 제거합니다. 개별 문장이나 용어의 정확성이 아니라, "계속 읽고 싶은가"라는 관성의 문제입니다.

#### 점검 대상

| 멈춤 유형 | 설명 | 예시 |
|----------|------|------|
| 난이도 점프 | 갑자기 어려워지는 지점 | 쉬운 개념 설명 후 RFC 세부사항이 갑자기 등장 |
| 맥락 없는 새 개념 | 왜 이것이 지금 나오는지 모름 | 이전 내용과 연결 없이 새 섹션 시작 |
| 과도한 길이 | 너무 긴 문단/섹션 | 한 문단이 10줄 이상 |
| 반복으로 인한 지루함 | 같은 내용이 반복됨 | 이미 설명한 것을 다시 풀어 설명 |

#### 수정 전략

1. **난이도 점프**: 쉬운 도입 문장을 추가하거나, 어려운 내용 앞에 배경을 보충
2. **맥락 없는 새 개념**: "앞에서 ~를 살펴봤습니다. 이제 ~를 봅니다" 형태의 브릿지 추가
3. **과도한 길이**: 문단 분리, `<br>` 추가
4. **반복**: 중복 문장/문단 제거

#### 점검 항목
- [ ] 읽다가 "갑자기 어려워졌다"고 느끼는 지점이 있는가?
- [ ] "이게 왜 지금 나오지?"라고 느끼는 지점이 있는가?
- [ ] 10줄 이상의 문단이 있는가?
- [ ] "이것은 아까 읽은 것 아닌가?"라고 느끼는 지점이 있는가?

---

### 축 2. 이해 곡선 (Comprehension Curve)

**"이 순서로 읽으면 자연스럽게 이해가 쌓이는가?"**

개별 문단의 설명 품질이 아니라, 문단들의 **배치 순서**가 이해의 누적을 돕는지 점검합니다.

#### 점검 대상

| 문제 유형 | 설명 | 예시 |
|----------|------|------|
| 순서 역전 | 개념 B를 이해하려면 A를 알아야 하는데, B가 A보다 먼저 나옴 | "리졸버가 루트 서버에 질의합니다" → 리졸버 설명이 뒤에 있음 |
| 흐름 불일치 | 추상→구체 또는 구체→추상 방향이 섹션 내에서 뒤섞임 | 원리 설명 중간에 갑자기 구체적 설정 예시, 다시 원리로 복귀 |
| 기반 개념 누락 | 뒤에서 사용하는 개념이 앞에서 소개되지 않음 | Zone File 형식을 설명하면서 SOA 레코드를 사전 설명 없이 사용 |

#### 수정 전략

1. **순서 역전**: 의존하는 개념이 먼저 나오도록 문단 순서 조정
2. **흐름 불일치**: 추상→구체 또는 구체→추상 중 하나로 통일
3. **기반 개념 누락**: 필요한 개념을 사용 전에 간략히 소개하거나, "뒤에서 자세히 다룹니다"로 예고

#### 점검 항목
- [ ] 개념 A를 알아야 이해되는 개념 B가 A보다 먼저 등장하는 곳이 있는가?
- [ ] 한 섹션 내에서 추상→구체 또는 구체→추상 흐름이 일관적인가?
- [ ] 뒤에서 사용하는 개념이 앞에서 충분히 소개되었는가?

---

### 축 3. 기대-충족 일치 (Expectation Alignment)

**"섹션 제목/도입부가 약속한 것을 본문이 실제로 제공하는가?"**

독자는 섹션 제목과 도입부를 읽으며 "이 섹션에서 무엇을 알게 되겠구나"라는 기대를 형성합니다. 본문이 그 기대를 충족하지 못하면 독자는 혼란을 느낍니다.

#### 점검 대상

| 문제 유형 | 설명 | 예시 |
|----------|------|------|
| 제목-내용 괴리 | 제목이 약속한 범위와 실제 내용이 다름 | 제목: "확장성의 한계" → 내용: 이름 충돌만 설명 (확장성과의 연결 없음) |
| 미답변 질문 | 도입에서 제기한 질문에 본문이 답하지 않음 | "어떻게 가능할까요?"로 시작했는데 답 없이 다음 섹션으로 넘어감 |
| 과잉 제공 | 제목이 약속하지 않은 내용이 포함됨 | "DNS 질의 과정" 섹션에서 캐싱 최적화 전략까지 다룸 |

#### 수정 전략

1. **제목-내용 괴리**: 제목을 내용에 맞게 수정하거나, 내용이 제목의 약속을 뒷받침하도록 보충
2. **미답변 질문**: 답변을 추가하거나, 질문을 "뒤에서 다룹니다"로 수정
3. **과잉 제공**: 범위를 벗어나는 내용을 별도 섹션으로 분리하거나, 제목을 확장

#### 점검 항목
- [ ] 섹션 제목이 약속한 내용과 실제 본문 내용이 일치하는가?
- [ ] 도입부에서 제기한 질문이 해당 섹션 내에서 답변되는가?
- [ ] 섹션의 범위를 벗어나는 내용이 포함되어 있는가?

---

## 자동 분할 규칙

파일을 읽은 후 다음 기준으로 개념 단위를 나눕니다.

### 분할 절차

```
1. YAML 프론트매터 건너뛰기 (첫 번째 `---` ~ 두 번째 `---`)
2. 분할 경계 식별 (우선순위순):
   a. `## ` (H2) → 대단위 섹션 경계
   b. `---` (수평선) → 섹션 구분자
   c. `### ` (H3) → 소단위 섹션 경계
   d. 빈 줄 2개 이상 → 문단 그룹 경계
3. 단위 크기 조정:
   - 30줄 초과 → 문단 경계(빈 줄)에서 추가 분할
   - 5줄 미만 → 인접 단위와 병합
4. 각 단위에 기록:
   - 라인 범위 (시작 줄 번호 ~ 끝 줄 번호)
   - 소속 섹션 제목
   - 직전 단위의 마지막 1~2문장 (맥락용)
   - 직후 단위의 첫 1~2문장 (맥락용)
```

---

## 서브에이전트 프롬프트 템플릿

각 단위에 대해 아래 프롬프트로 `Task` 도구(`subagent_type=general-purpose`)를 호출합니다.

```
다음 텍스트를 "처음 읽는 독자"의 관점에서 리뷰하고, 문제가 있으면 Edit 도구로 직접 수정하세요.

## 대상 파일
{파일 경로}

## 수정할 범위
라인 {시작}~{끝}

## 소속 섹션
{섹션 제목}

## 맥락
- 직전 단위 끝: "{직전 단위의 마지막 1~2문장}"
- 직후 단위 시작: "{직후 단위의 첫 1~2문장}"

## 수정할 텍스트
"""
{해당 단위의 전체 텍스트}
"""

## 3개 점검 축

아래 3개 축으로 점검하세요. 개별 문장의 품질이 아니라, **흐름 속에서의 독자 경험**을 봅니다.

### 축 1. 읽기 관성 (Reading Momentum)
"이 지점에서 독자가 읽기를 멈추는가?"
- 갑작스러운 난이도 점프가 있는가?
- 왜 이것이 지금 나오는지 맥락이 없는 새 개념이 있는가?
- 너무 긴 문단(10줄 이상)이 있는가?
- 이미 설명한 내용의 반복으로 지루한 지점이 있는가?

### 축 2. 이해 곡선 (Comprehension Curve)
"이 순서로 읽으면 자연스럽게 이해가 쌓이는가?"
- 개념 A를 알아야 이해되는 개념 B가 A보다 먼저 나오지 않는가?
- 추상→구체 또는 구체→추상 흐름이 일관적인가?
- 뒤에서 사용하는 개념이 앞에서 충분히 소개되었는가?

### 축 3. 기대-충족 일치 (Expectation Alignment)
"섹션 제목/도입부가 약속한 것을 본문이 실제로 제공하는가?"
- 제목이 약속한 내용과 실제 내용에 괴리가 있는가?
- 도입에서 제기한 질문에 대한 답변이 누락되었는가?
- 섹션의 범위를 벗어나는 내용이 포함되어 있는가?

## 수정 규칙

- 문제를 발견하면 `Edit` 도구로 해당 파일의 해당 부분을 직접 수정하세요.
- 원래 의미를 훼손하지 마세요.
- 맥락(직전/직후 단위)과의 흐름이 끊어지지 않도록 하세요.
- 수정할 것이 없으면 수정하지 마세요.
- YAML 프론트매터는 절대 수정하지 마세요.
- 섹션 제목(## , ### )은 수정하지 마세요.
- **개념 단위 사이 간격**: 하나의 개념 설명이 끝나고 다음 개념으로 넘어가는 지점에는 빈줄 + `<br>` + 빈줄 형식으로 시각적 간격을 추가하세요. 단, 다음 경우에는 추가하지 않습니다:
  - 섹션 제목(`##`, `###`) 직전/직후
  - 코드 블록 내부
  - 이미 `<br>`이 존재하는 곳
  - 하나의 개념을 여러 문단에 걸쳐 설명하는 도중 (같은 개념 내 문단 사이에는 불필요)

## 출력 형식

수정이 있었다면, 아래 형식으로 변경 사항을 요약하세요:

### 라인 {시작}~{끝} 변경 사항
- [축 번호] 문제 설명: 수정 내용 요약

수정이 없었다면 "수정 없음"이라고 출력하세요.
```

---

## 작업 프로세스

### 1단계: 파일 읽기 + 구조 파악
- `$ARGUMENTS`가 있으면 해당 파일을 `Read` 도구로 읽기
- 없으면 사용자에게 파일 경로를 요청
- 파일 전체 구조(프론트매터, 섹션 제목, 전체 줄 수)를 파악

### 2단계: 개념 단위 자동 분할
- 위 "자동 분할 규칙"에 따라 파일을 개념 단위로 분할
- 각 단위의 라인 범위, 소속 섹션, 맥락(직전/직후) 기록
- 분할 결과를 사용자에게 출력:
  ```
  ## 분할 결과
  - 단위 1: 라인 {시작}~{끝} — "{섹션 제목}" ({줄 수}줄)
  - 단위 2: 라인 {시작}~{끝} — "{섹션 제목}" ({줄 수}줄)
  ...
  총 {N}개 단위로 분할되었습니다. 병렬 리뷰를 시작합니다.
  ```

### 3단계: 서브에이전트 프롬프트 생성
- 각 단위별로 위 프롬프트 템플릿을 채워 프롬프트를 생성

### 4단계: 병렬 실행
- 모든 서브에이전트를 `Task` 도구(`subagent_type=general-purpose`)로 **병렬** 실행
- 하나의 메시지에서 모든 `Task` 호출을 동시에 수행

### 5단계: 결과 수집 + 요약 출력
- 모든 서브에이전트의 결과를 수집
- 변경 사항을 축별로 분류하여 요약 출력:
  ```
  ## 리뷰 결과 요약

  ### 축별 수정 현황
  | 축 | 수정 건수 | 주요 내용 |
  |---|----------|----------|
  | 1. 읽기 관성 | N건 | ... |
  | 2. 이해 곡선 | N건 | ... |
  | 3. 기대-충족 일치 | N건 | ... |

  ### 단위별 상세
  (각 서브에이전트의 변경 사항)
  ```

---

## 주의사항

### 다른 커맨드와의 경계

이 스킬의 3개 축은 앞 5개 커맨드의 어떤 항목과도 겹치지 않습니다:
- `/edit-writing`은 개별 문장/문단의 구조를 다룹니다 → 이 스킬은 문단 간 **흐름**을 봅니다
- `/clarify-writing`은 설명의 완성도를 다룹니다 → 이 스킬은 설명의 **순서**를 봅니다
- `/refine-style`은 톤과 리듬을 다룹니다 → 이 스킬은 **읽기 관성**을 봅니다
- `/smooth-flow`는 문장/문단 간 **미시적 흐름**을 다룹니다 → 이 스킬은 **거시적 독자 경험**을 봅니다
- `/verify-facts`는 사실 정확성을 다룹니다 → 이 스킬은 **기대-충족 일치**를 봅니다
- `/align-reference`는 **레퍼런스 대비 구조/품질 일관성**을 다룹니다 → 이 스킬은 **글 내 독자 경험**을 봅니다

### 서브에이전트 간 충돌 방지
- 각 서브에이전트는 **자신에게 할당된 라인 범위만** 수정합니다.
- 다른 단위의 내용을 참조하되 수정하지 않습니다.
- 맥락 정보(직전/직후 단위)는 읽기 전용입니다.

### 맥락 전달
- 직전/직후 단위의 첫/끝 문장을 전달하여, 흐름이 끊어지지 않도록 합니다.
- 소속 섹션 제목을 전달하여, 기대-충족 일치(축 3)를 판단할 수 있게 합니다.

### 원본 보존
- YAML 프론트매터는 수정하지 않습니다.
- 섹션 제목(## , ### )은 수정하지 않습니다.
- 원래 의미와 글의 전체 구조를 훼손하지 않습니다.

### 수정 기준
- 문제가 없는 부분은 수정하지 않습니다.
- 수정은 최소한으로, 발견된 문제에만 적용합니다.
- "더 좋게"가 아니라 "문제가 있으면 고치기"가 기준입니다.
