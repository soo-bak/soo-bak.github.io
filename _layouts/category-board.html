---
layout: default
---

{% comment %}
  카테고리 게시판 레이아웃

  front matter에서 사용 가능한 변수:
    - title: 카테고리 제목
    - description: 카테고리 설명
    - category_icon: 아이콘 (emoji)
    - category_path: 포스트 경로 필터 (예: "algorithm/")
{% endcomment %}

{% if page.header.overlay_color or page.header.overlay_image or page.header.image %}
  {% include page__hero.html %}
{% elsif page.header.video.id and page.header.video.provider %}
  {% include page__hero_video.html %}
{% endif %}

<div id="main" role="main">
  {% include sidebar.html %}

  <div class="archive">
    {% if page.url != "/" and site.breadcrumbs %}
      {% unless paginator %}
        {% include my-breadcrumbs.html %}
      {% endunless %}
    {% endif %}

    {% comment %} 카테고리 경로 추출 {% endcomment %}
    {% assign current_path = page.url | remove: "/index.html" | remove: "/" %}
    {% assign path_parts = current_path | split: "/" %}

    {% comment %} 현재 카테고리의 포스트 필터링 {% endcomment %}
    {% comment %} page.url: /daily-life/ → filter_path: daily-life/ {% endcomment %}
    {% assign filter_path = page.url | remove: "/index.html" | remove_first: "/" %}
    {% unless filter_path == "" %}
      {% unless filter_path contains "/" %}
        {% assign filter_path = filter_path | append: "/" %}
      {% endunless %}
    {% endunless %}
    {% assign category_posts = "" | split: "" %}

    {% for post in site.posts %}
      {% if post.path contains filter_path %}
        {% assign category_posts = category_posts | push: post %}
      {% endif %}
    {% endfor %}

    {% assign category_posts = category_posts | sort: "date" | reverse %}
    {% assign post_count = category_posts.size %}

    {% comment %} 하위 카테고리 찾기 {% endcomment %}
    {% assign subcategories = "" | split: "" %}
    {% assign current_url_normalized = page.url | remove: "index.html" %}

    {% comment %} navigation.yml에서 현재 카테고리의 하위 항목 찾기 {% endcomment %}
    {% for item in site.data.navigation.main-sidebar %}
      {% assign item_url_normalized = item.url | append: "" %}
      {% if item_url_normalized == current_url_normalized %}
        {% if item.children %}
          {% for child in item.children %}
            {% assign subcategories = subcategories | push: child %}
          {% endfor %}
        {% endif %}
      {% else %}
        {% if item.children %}
          {% for child in item.children %}
            {% assign child_url_normalized = child.url | append: "" %}
            {% if child_url_normalized == current_url_normalized %}
              {% if child.children %}
                {% for grandchild in child.children %}
                  {% assign subcategories = subcategories | push: grandchild %}
                {% endfor %}
              {% endif %}
            {% endif %}
          {% endfor %}
        {% endif %}
      {% endif %}
    {% endfor %}

    {% comment %} 하위 분류 표시 여부 결정 {% endcomment %}
    {% assign show_subcategory = false %}
    {% if subcategories.size > 0 %}
      {% assign show_subcategory = true %}
    {% elsif path_parts.size == 1 %}
      {% assign show_subcategory = true %}
    {% endif %}

    <div class="category-board">
      {% comment %} 카테고리 헤더 {% endcomment %}
      {% include board/header.html
         title=page.title
         description=page.description
         count=post_count %}

      {% comment %} 하위 분류 탭 {% endcomment %}
      {% if subcategories.size > 0 %}
      <div class="category-board__tabs">
        <h4 class="category-board__tabs-title"><i class="fas fa-folder-open"></i> 하위 분류</h4>
        <ul class="category-board__tabs-list">
          {% for sub in subcategories %}
            {% assign sub_filter = sub.url | remove_first: "/" %}
            {% assign sub_count = 0 %}
            {% for post in site.posts %}
              {% if post.path contains sub_filter %}
                {% assign sub_count = sub_count | plus: 1 %}
              {% endif %}
            {% endfor %}
          <li class="category-board__tab">
            <a href="{{ sub.url | relative_url }}">
              {{ sub.title }}
              <span class="category-board__tab-count">{{ sub_count }}</span>
            </a>
          </li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}

      {% comment %} 컨텐츠 영역 {% endcomment %}
      <div class="category-board__content">
        {% comment %} 인기 글 {% endcomment %}
        {% include board/pinned-posts.html posts=category_posts show_subcategory=show_subcategory %}

        {% comment %} 전체 글 목록 {% endcomment %}
        <div class="category-board__all-posts">
          <h4 class="category-board__all-title"><i class="fas fa-list"></i> 전체 글 ({{ post_count }})</h4>

          <ul class="board__post-list" id="post-list">
            {% for post in category_posts %}
              {% include board/post-row.html post=post show_subcategory=show_subcategory %}
            {% endfor %}
          </ul>

          {% if post_count > 20 %}
          <div class="category-board__pagination" id="pagination">
            <div class="pagination__pages" id="pagination-pages"></div>
            <p class="category-board__pagination-info" id="pagination-info"></p>
          </div>

          <script>
          (function() {
            var postsPerPage = 20;
            var currentPage = 1;
            var postList = document.getElementById('post-list');
            var posts = postList.querySelectorAll('.board__post-row');
            var totalPosts = posts.length;
            var totalPages = Math.ceil(totalPosts / postsPerPage);
            var paginationPages = document.getElementById('pagination-pages');
            var paginationInfo = document.getElementById('pagination-info');

            function showPosts() {
              var start = (currentPage - 1) * postsPerPage;
              var end = start + postsPerPage;
              posts.forEach(function(post, index) {
                if (index >= start && index < end) {
                  post.style.display = 'flex';
                } else {
                  post.style.display = 'none';
                }
              });
              var showStart = start + 1;
              var showEnd = Math.min(end, totalPosts);
              paginationInfo.textContent = '총 ' + totalPosts + '개 글 중 ' + showStart + '-' + showEnd + '개 표시';
              renderPagination();
            }

            function renderPagination() {
              var html = '';
              if (currentPage > 1) {
                html += '<button class="pagination__btn pagination__btn--prev" data-page="' + (currentPage - 1) + '">‹</button>';
              }
              var startPage = Math.max(1, currentPage - 2);
              var endPage = Math.min(totalPages, currentPage + 2);
              if (startPage > 1) {
                html += '<button class="pagination__btn" data-page="1">1</button>';
                if (startPage > 2) html += '<span class="pagination__ellipsis">...</span>';
              }
              for (var i = startPage; i <= endPage; i++) {
                var activeClass = i === currentPage ? ' pagination__btn--active' : '';
                html += '<button class="pagination__btn' + activeClass + '" data-page="' + i + '">' + i + '</button>';
              }
              if (endPage < totalPages) {
                if (endPage < totalPages - 1) html += '<span class="pagination__ellipsis">...</span>';
                html += '<button class="pagination__btn" data-page="' + totalPages + '">' + totalPages + '</button>';
              }
              if (currentPage < totalPages) {
                html += '<button class="pagination__btn pagination__btn--next" data-page="' + (currentPage + 1) + '">›</button>';
              }
              paginationPages.innerHTML = html;
            }

            paginationPages.addEventListener('click', function(e) {
              if (e.target.matches('.pagination__btn')) {
                currentPage = parseInt(e.target.dataset.page);
                showPosts();
                postList.scrollIntoView({ behavior: 'smooth', block: 'start' });
              }
            });

            showPosts();
          })();
          </script>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
