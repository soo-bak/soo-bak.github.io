---
layout: single
title: "라우팅과 인터넷 구조 (3) - BGP와 인터넷의 구조 - soo:bak"
date: "2026-01-19 23:11:03 +0900"
description: 자율 시스템, BGP의 동작 원리, 인터넷의 계층 구조, Peering과 Transit을 설명합니다.
tags:
  - 네트워크
  - BGP
  - 인터넷
  - AS
  - ISP
---

## 인터넷은 하나의 네트워크인가

[Part 1](/dev/network/Routing-1/)과 [Part 2](/dev/network/Routing-2/)에서 RIP, OSPF 같은 IGP를 살펴보았습니다.

IGP는 하나의 조직 내부에서 사용됩니다.

<br>

하지만 인터넷은 하나의 조직이 아닙니다.

수만 개의 독립적인 네트워크가 연결된 "네트워크의 네트워크"입니다.

<br>

각 네트워크는 자신의 정책과 규칙을 가집니다.

- 어떤 트래픽을 받아들일 것인가
- 어떤 경로로 트래픽을 보낼 것인가
- 누구와 연결할 것인가

<br>

이런 독립적인 네트워크들이 어떻게 협력하여 전 세계적인 통신을 가능하게 할까요?

---

## 자율 시스템: 인터넷의 기본 단위

**자율 시스템(Autonomous System, AS)**은 단일한 라우팅 정책 하에 운영되는 네트워크 집합입니다.

<br>

각 AS는 고유한 번호를 가집니다.

**ASN(Autonomous System Number)**은 16비트(0~65535) 또는 32비트입니다.

IANA가 지역 인터넷 레지스트리(RIR)를 통해 할당합니다.

<br>

예시:
- AS15169: Google
- AS32934: Facebook
- AS8075: Microsoft
- AS4766: Korea Telecom
- AS3786: LG Uplus

<br>

AS의 특성:

1. **단일 관리**: 하나의 조직이 운영
2. **단일 정책**: 일관된 라우팅 정책 적용
3. **외부에 대한 통일된 모습**: 내부 구조는 외부에 숨김

<br>

AS 내부에서는 OSPF, IS-IS 같은 IGP를 사용합니다.

AS 간에는 **BGP(Border Gateway Protocol)**를 사용합니다.

---

## BGP: 인터넷의 접착제

**BGP**는 AS 간 라우팅을 담당하는 유일한 프로토콜입니다.

현재 버전은 BGP-4 (RFC 4271).

<br>

BGP의 특성:

- **경로 벡터(Path Vector)** 프로토콜
- TCP 포트 179 사용
- **정책 기반** 라우팅

<br>

거리 벡터와 경로 벡터의 차이:

```
거리 벡터:
"목적지 X까지 거리 5"

경로 벡터:
"목적지 X까지 AS1 → AS2 → AS3 경로로"
```

<br>

전체 경로(AS-PATH)를 알기 때문에:
- 루프 탐지가 쉬움 (자신의 AS가 경로에 있으면 거부)
- 정책 적용이 가능 (특정 AS를 거치는 경로 회피)

---

## BGP의 동작

**BGP 피어링**

BGP는 수동으로 구성된 이웃(피어)과만 통신합니다.

자동 발견이 없습니다.

<br>

```
AS 100                    AS 200
┌──────────┐              ┌──────────┐
│ 라우터 A ├──── BGP ────┤ 라우터 B │
└──────────┘   세션       └──────────┘
```

라우터 A와 B는 TCP 연결을 맺고 BGP 메시지를 교환합니다.

<br>

**BGP 메시지 유형**

1. **OPEN**: 세션 시작, 파라미터 협상
2. **UPDATE**: 경로 정보 광고/철회
3. **KEEPALIVE**: 연결 유지 확인 (기본 60초 간격)
4. **NOTIFICATION**: 오류 통보, 세션 종료

<br>

**iBGP vs eBGP**

- **eBGP(External BGP)**: 서로 다른 AS 간
- **iBGP(Internal BGP)**: 같은 AS 내부의 BGP 라우터 간

<br>

왜 같은 AS 내부에서도 BGP가 필요할까요?

<br>

AS가 여러 외부 연결을 가질 때:

```
        AS 200              AS 300
           │                   │
      ┌────┴────┐         ┌────┴────┐
      │ 라우터 X │  iBGP  │ 라우터 Y │
      └────┬────┘ ◄────► └────┬────┘
           │     AS 100       │
           └───────┬──────────┘
                   │
              (내부 IGP)
```

X가 AS200에서 배운 경로를 Y에게 알려줘야 합니다.

Y는 그 정보로 AS300에 광고할 내용을 결정합니다.

<br>

iBGP는 AS 내부의 모든 BGP 라우터가 풀 메시(full mesh)로 연결되어야 합니다.

또는 Route Reflector나 Confederation을 사용합니다.

---

## BGP 경로 선택

BGP는 같은 목적지로 가는 여러 경로를 받을 수 있습니다.

어떤 경로를 선택할까요?

<br>

BGP는 복잡한 **경로 선택 알고리즘**을 사용합니다.

순서대로 비교하여 하나가 결정되면 멈춥니다.

<br>

```
1. Weight (Cisco 전용, 높을수록 선호)
2. LOCAL_PREF (로컬 선호도, 높을수록 선호)
3. 로컬에서 생성된 경로 선호
4. AS_PATH 길이 (짧을수록 선호)
5. Origin 타입 (IGP > EGP > Incomplete)
6. MED (Multi-Exit Discriminator, 낮을수록 선호)
7. eBGP > iBGP
8. IGP 메트릭이 낮은 넥스트홉
9. 가장 오래된 경로
10. 라우터 ID가 낮은 피어
11. 클러스터 리스트 길이
12. 피어 IP 주소가 낮은 쪽
```

<br>

실제로 중요한 것:

**LOCAL_PREF**: AS 내부에서 나가는 트래픽의 선호 경로 설정

**AS_PATH**: 기본적으로 짧은 경로 선호

**MED**: 이웃 AS에게 "이 링크로 들어와라" 힌트

<br>

예시:

```
AS 100에서 AS 300으로 가는 두 경로:

경로 1: AS 100 → AS 200 → AS 300 (AS_PATH 길이: 2)
경로 2: AS 100 → AS 400 → AS 500 → AS 300 (AS_PATH 길이: 3)

→ 경로 1 선택 (AS_PATH가 짧음)
```

<br>

하지만 LOCAL_PREF가 설정되어 있다면:

```
경로 1: LOCAL_PREF = 100
경로 2: LOCAL_PREF = 200

→ 경로 2 선택 (LOCAL_PREF가 높음, AS_PATH는 무시됨)
```

<br>

정책이 최적 경로보다 우선합니다.

이것이 IGP와의 근본적인 차이입니다.

---

## 인터넷의 계층 구조

인터넷의 AS들은 계층적 구조를 형성합니다.

<br>

**Tier-1 ISP**

- 전 세계 어디든 도달 가능 (기본 경로 필요 없음)
- 다른 Tier-1과 **피어링(Peering)** (무료 상호 연결)
- 하위 ISP에게 **트랜짓(Transit)** 제공 (유료)
- 예: AT&T, NTT, Lumen, Cogent

<br>

**Tier-2 ISP**

- Tier-1에게 트랜짓 구매
- 다른 Tier-2와 피어링
- 하위 ISP/기업에게 트랜짓 판매
- 예: 대부분의 대형 지역 ISP

<br>

**Tier-3 ISP**

- 트랜짓만 구매 (피어링 거의 없음)
- 최종 고객에게 인터넷 제공
- 예: 소규모 지역 ISP

<br>

**컨텐츠 제공자**

- 대형 컨텐츠 기업 (Google, Netflix, Meta)
- 자체 글로벌 네트워크 운영
- 많은 ISP와 직접 피어링

<br>

```
              Tier-1 ══════ Tier-1
                 ║             ║
              Tier-2 ──────Tier-2
               ╱ ╲           ╱ ╲
          Tier-3  Tier-3 Tier-3 Tier-3
            │       │       │       │
          고객    고객    고객    고객
```

---

## Peering vs Transit

**피어링(Peering)**은 두 네트워크가 서로의 트래픽을 무료로 교환하는 것입니다.

<br>

조건:
- 대등한 트래픽 교환 (비대칭이면 한쪽이 손해)
- 상호 이익이 있을 때

<br>

```
AS 100 ◄════════► AS 200
      (피어링)

AS 100의 고객 트래픽 → AS 200에 무료로 전달
AS 200의 고객 트래픽 → AS 100에 무료로 전달
```

<br>

**트랜짓(Transit)**은 인터넷 전체로의 접근을 제공하는 유료 서비스입니다.

<br>

```
      Tier-1
         ║ (트랜짓: 돈 지불)
      Tier-2
         ║
       고객

Tier-2는 Tier-1에게 비용을 지불하고
인터넷 전체로 가는 경로를 얻습니다.
```

<br>

피어링이 항상 좋을까요?

<br>

피어링의 장점:
- 비용 절감 (트랜짓 비용 회피)
- 지연시간 감소 (직접 연결)
- 대역폭 증가

<br>

피어링의 비용:
- 피어링 포인트까지의 연결 비용
- 장비, 포트 비용
- 관리 오버헤드

<br>

대형 컨텐츠 제공자는 가능한 많은 ISP와 직접 피어링하려 합니다.

트랜짓 비용을 줄이고 사용자 경험을 개선하기 위해서입니다.

---

## Internet Exchange Point

**IX(Internet Exchange Point)**는 여러 네트워크가 한 곳에서 피어링할 수 있는 시설입니다.

<br>

IX 없이 10개 네트워크가 모두 피어링하려면:

10 × 9 / 2 = 45개의 개별 연결이 필요합니다.

<br>

IX를 사용하면:

모든 네트워크가 IX에 한 번 연결하고, IX 내부에서 피어링합니다.

```
     ┌─────────────────────────┐
     │   Internet Exchange     │
     │  ┌─────────────────┐   │
     │  │ 스위칭 패브릭  │   │
     │  └─────────────────┘   │
     │   ↑    ↑    ↑    ↑     │
     └───┼────┼────┼────┼─────┘
         │    │    │    │
       AS1  AS2  AS3  AS4
```

<br>

세계 주요 IX:

- DE-CIX (프랑크푸르트): 최대 규모
- AMS-IX (암스테르담)
- LINX (런던)
- Equinix IX (여러 도시)
- KINX (서울)

<br>

IX에서의 피어링 유형:

**공개 피어링(Public Peering)**: IX의 공유 스위치를 통해

**사설 피어링(Private Peering)**: IX 시설 내에서 직접 연결

---

## BGP 보안 문제

BGP는 1989년에 설계되었습니다.

신뢰를 기반으로 했습니다.

<br>

**BGP 하이재킹**

악의적이거나 실수로 잘못된 경로를 광고하면?

<br>

2008년 파키스탄 텔레콤 사건:

파키스탄 정부가 YouTube 차단을 명령했습니다.

파키스탄 텔레콤이 YouTube IP를 자신에게로 광고했습니다.

실수로 이 광고가 전 세계로 퍼졌습니다.

전 세계 YouTube 트래픽이 파키스탄으로 향했습니다.

<br>

```
정상:
사용자 → ISP → YouTube (AS36561)

하이재킹 후:
사용자 → ISP → 파키스탄 텔레콤 (← "YouTube 여기요!")
```

<br>

이것이 가능한 이유:

BGP는 경로 광고의 진위를 검증하지 않습니다.

누구나 "이 IP 대역은 내 것"이라고 주장할 수 있습니다.

<br>

**해결책들**

**RPKI(Resource Public Key Infrastructure)**

IP 대역과 AS의 소유권을 암호화 서명으로 증명합니다.

ROA(Route Origin Authorization)로 "AS X만이 IP 대역 Y를 광고할 수 있다"를 명시합니다.

<br>

```
ROA 예시:
IP 대역: 203.0.113.0/24
허가된 AS: AS 64500
최대 접두사 길이: /24

다른 AS가 203.0.113.0/24를 광고하면?
→ RPKI 검증 실패, 경로 거부 가능
```

<br>

RPKI 도입이 증가하고 있지만 아직 보편적이지 않습니다.

모든 ISP가 검증을 해야 효과가 있습니다.

<br>

**BGPsec**

경로 전체를 암호화 서명합니다.

AS_PATH의 각 AS가 서명하여 경로 조작을 방지합니다.

하지만 계산 오버헤드가 크고 도입이 느립니다.

---

## 인터넷 라우팅의 현실

인터넷 라우팅은 기술적 최적화만이 아닙니다.

경제적, 정치적 요소가 큽니다.

<br>

**경제적 결정**

- 비싼 트랜짓 대신 피어링 추구
- 비용 효율적인 경로 선택 (항상 최단 경로가 아님)
- 트래픽 비율에 따른 피어링 협상

<br>

**정치적 결정**

- 특정 국가를 경유하지 않는 경로 선택
- 데이터 주권 문제로 국내 트래픽은 국내에서 처리
- 정부 규제에 따른 필터링

<br>

**운영적 결정**

- 안정성이 검증된 경로 선호
- 장애 이력이 있는 AS 회피
- 24/7 NOC(Network Operations Center) 운영 여부

<br>

BGP의 정책 기반 특성은 이런 다양한 요구를 수용합니다.

"최단 경로"가 아니라 "최선의 경로"를 선택합니다.

그 "최선"의 정의는 각 네트워크가 결정합니다.

---

## 정리: 인터넷이 동작하는 이유

인터넷은 중앙 제어 없이 동작합니다.

수만 개의 AS가 자율적으로 운영됩니다.

<br>

가능하게 하는 것들:

1. **AS 번호**: 각 네트워크의 고유 식별자
2. **BGP**: AS 간 경로 정보 교환의 공통 언어
3. **IP 주소 할당 체계**: 중복 없는 주소 공간
4. **상호 의존성**: 연결되지 않으면 고객에게 서비스 불가

<br>

인터넷은 기술적 프로토콜 위에 경제적 인센티브가 동작하는 시스템입니다.

BGP가 "인터넷의 접착제"라고 불리는 이유입니다.

---

**관련 글**
- [라우팅과 인터넷 구조 (1) - 라우팅의 기본 원리](/dev/network/Routing-1/)
- [라우팅과 인터넷 구조 (2) - 라우팅 알고리즘](/dev/network/Routing-2/)
- [IP 주소(IP Address)의 개념과 구조](/dev/network/IPAddress/)
- [서브넷(Subnet)의 개념과 서브네팅](/dev/network/Subnet/)
- [네트워크 통신의 원리 (3) - 프로토콜 스택과 데이터 흐름](/dev/network/NetworkCommunication-3/)
